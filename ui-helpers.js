// Tangular
(function(e){if(e.Tangular)return;var t={};var v=t.helpers={};t.version='v5.0.5';t.cache={};e.Ta=e.Tangular=t;e.Thelpers=v;var s={null:true,undefined:true,true:true,false:true,Object:1,String:1,Number:1,Boolean:1,Date:1,Array:1,window:1,global:1,arguments:1,eval:1,Function:1,function:1,var:1,let:1,const:1,delete:1};var l=/\{\{.*?\}\}/g;var u=/\{\{|\}\}/g;var n=/[<>&"]/g;var o=/\n$/g;function w(e,r){var t='';var n=[];var i=0;for(var a=0;a<e.length;a++){var l=e.charCodeAt(a);if(!i){if(t&&l>47&&l<58||l>64&&l<91||l>96&&l<123||(l===95||l===36)){t+=e.charAt(a);continue}if(t){if(!s[t]&&n.indexOf(t)===-1&&(!r||r.indexOf(t)===-1))n.push(t);t=''}}if(l===46||l===124){i=l}else if((i===46||i===124)&&l===40){i=0}else if(l===96||l===34||l===39){if(l===i)i=0;else i=l}}if(t&&!s[t]&&n.indexOf(t)===-1&&(!r||r.indexOf(t)===-1))n.push(t);return n}t.toArray=function(e){var r=Object.keys(e);var t=[];for(var n=0,i=r.length;n<i;n++)t.push({key:r[n],value:e[r[n]]});return t};function i(){this.commands;this.variables;this.builder;this.split='\0'}i.prototype.compile=function(e,r,t){var g=this;var m=0;var b=0;var $=[];var a=l;var y=u;var x;if(r&&t){a=new RegExp(r+'.*?'+t,'g');y=new RegExp(r+'|'+t,'g')}g.template=e;e=e.replace(/\|\|/g,'');g.variables={};g.commands=[];g.builder=e.replace(a,function(f){var e=f.replace(y,'').trim();var r=null;var t=null;var n;var c=false;var v=false;var p=true;if(e==='fi'){m--}else if(e==='end'){b--;$.pop()}else if(e.substring(0,3)==='if '){m++;r=w(e.substring(3),$);if(r.length){for(var i=0;i<r.length;i++){var a=r[i];if(g.variables[a])g.variables[a]++;else g.variables[a]=1}}else r=null;c=true;p=true}else if(e.substring(0,8)==='foreach '){b++;x=e.substring(8).split(' ');$.push(x[0].trim());n=x[2].indexOf('.');if(n!==-1)x[2]=x[2].substring(0,n);r=x[2].trim();if($.indexOf(r)===-1){if(g.variables[r])g.variables[r]++;else g.variables[r]=1;r=[r]}else r=null;v=true}else if(e.substring(0,8)==='else if '){r=w(e.substring(8),$);if(r.length){for(var i=0;i<r.length;i++){var a=r[i];if(g.variables[a])g.variables[a]++;else g.variables[a]=1}}else r=null;c=true}else if(e!=='continue'&&e!=='break'&&e!=='else'){r=w(e);var l=false;for(var i=0;i<r.length;i++){var s=r[i];if(s+'('===e.substring(0,s.length+1)){l=true;continue}if(g.variables[s])g.variables[s]++;else g.variables[s]=1}if(!r.length)r=null;var u=e.indexOf('|');var h=null;if(l){h=e.substring(0,u===-1?e.length:u);if(u===-1)e='';else e=''+e.substring(n)}else if(!l&&u===-1)e+=' | encode';t=e.split('|');e=t[0];t=t.slice(1);if(l)t.unshift(h);if(t.length){for(var i=0;i<t.length;i++){var o=t[i].trim();var d=l&&!i;n=o.indexOf('(');if(n===-1){o='Thelpers.$execute($helpers,model,\''+o+'\','+(d?'':')')}else o='Thelpers.$execute($helpers,model,\''+o.substring(0,n)+'\','+(d?'':',')+o.substring(n+1);t[i]=o}}else t=null;e=g.safe(e.trim()||'model');p=false}g.commands.push({index:g.commands.length,cmd:e,ifcount:m,loopcount:b,variable:r,helpers:t,isloop:v,isif:c,iscode:p});return g.split}).split(g.split);for(var n=0;n<g.builder.length;n++){var i=g.builder[n];g.builder[n]=i?i.replace(o,''):i}return g.make()};i.prototype.safe=function(e){var r=e.split('.');var t=[];for(var n=1;n<r.length;n++){var i=r.slice(0,n).join('.');t.push(i+'==null?\'\':')}return t.join('')+r.join('.')};i.prototype.make=function(){var e=this;var r=['var $output=$text[0];var $tmp;var $index=0;'];for(var t=0,f=e.commands.length;t<f;t++){var n=e.commands[t];var i;t&&r.push('$output+=$text['+t+'];');if(n.iscode){if(n.isloop){var a='$i'+Math.random().toString(16).substring(3,6);var l=a+'a';var c=n.cmd.lastIndexOf(' in ');if(c===-1)c=n.cmd.lastIndexOf(' of ');i=n.cmd.substring(c+4).trim();i=l+'='+e.safe(i)+';if(!('+l+' instanceof Array)){if('+l+'&&typeof('+l+')===\'object\')'+l+'=Tangular.toArray('+l+')}if('+l+' instanceof Array&&'+l+'.length){for(var '+a+'=0,'+a+'l='+l+'.length;'+a+'<'+a+'l;'+a+'++){$index='+a+';var '+n.cmd.split(' ')[1]+'='+l+'['+a+'];';r.push(i)}else if(n.isif){if(n.cmd.substring(0,8)==='else if ')r.push('}'+n.cmd.substring(0,8).trim()+'('+n.cmd.substring(8).trim()+'){');else r.push(n.cmd.substring(0,3).trim()+'('+n.cmd.substring(3).trim()+'){')}else{switch(n.cmd){case'else':r.push('}else{');break;case'end':r.push('}}');break;case'fi':r.push('}');break;case'break':r.push('break;');break;case'continue':r.push('continue;');break}}}else{if(n.helpers){var s='';for(var u=0;u<n.helpers.length;u++){var v=n.helpers[u];if(u===0)s=v.replace('',n.cmd.trim()).trim();else s=v.replace('',s.trim())}r.push('$tmp='+s+';if($tmp!=null)$output+=$tmp;')}else r.push('if('+n.cmd+'!=null)$output+='+n.cmd+';')}}r.push((f?'$output+=$text['+f+'];':'')+'return $output.charAt(0) === \'\\n\'?$output.substring(1):$output;');delete e.variables.$;var o=Object.keys(e.variables);var p=['$helpers||{}','$||{}','model'];for(var t=0;t<o.length;t++)p.push('model.'+o[t]);for(var t=0;t<e.builder.length;t++)e.builder[t]=e.builder[t].replace(/\1/g,'||');var h='var tangular=function($helpers,$,model'+(o.length?','+o.join(','):'')+'){'+r.join('')+'};return function(model,$,$helpers){try{return tangular('+p.join(',')+')}catch(e){console.error(\'Tangular error:\',e + \'\',$template)}}';return new Function('$text','$template',h.replace(/\1/g,'||'))(e.builder,e.template)};v.$execute=function(e,r,t,n,i,a,l,s,u,f,c){var o=e[t]||v[t];if(!o){console&&console.warn('Tangular: missing helper','"'+t+'"');return n}return o.call(r,n,i,a,l,s,u,f,c)};v.encode=function(e,r){if(r){if(typeof r==='function')return r(e);if(r==='json')return JSON.stringify(e);if(r==='json2')return JSON.stringify(e,null,'\t');if(r==='url'||r==='urlencoded')return encodeURIComponent(e);if(r==='querify')return QUERIFY(e)}return e==null?'':(e+'').replace(n,function(e){switch(e){case'&':return'&amp;';case'<':return'&lt;';case'>':return'&gt;';case'"':return'&quot;'}return e})};v.raw=function(e){return e};t.render=function(e,r,t,n){var e=(new i).compile(e);return e(r==null?{}:r,t,n)};t.compile=function(e,r,t){return(new i).compile(e,r,t)};t.register=function(e,r){v[e]=r;return t}})(window);

// Tangular helpers
Thelpers.pluralize=function(r,e,t,a,n){return r||(r=0),'number'!=typeof r&&(r=parseFloat(r.toString().replace(/\s/g,'').replace(',','.'))),r.pluralize(e,t,a,n)},Thelpers.format=function(r,e,t,a){var n=typeof r;if(r==null)return'';if('number'===n||r instanceof Date)return r.format(e==null?null:e,t,a);'string'!==n&&(r=r.toString()),r=r.trim();for(var i=!1,o=0,f=0,u=0,l=r.length;l>u;u++){var g=r.charCodeAt(u);if(58===g||32===g||84===g){i=!0;break}if(45===g){if(o++,1===o)continue;i=!0;break}if(46===g){if(f++,1===f)continue;i=!0;break}}return i?r.parseDate().format(e||'dd.MM.yyyy'):r.parseFloat().format(e,t,a)};Thelpers.def=Thelpers.empty=function(e,n){return e?Thelpers.encode(e):n||DEF.empty};Thelpers.currency=function(e,t){switch(typeof e){case'number':return e.currency(t);case'string':return e.parseFloat().currency(t);default:return''}};Thelpers.cl=function(id,name,key){var cl=DEF.cl[name];return cl instanceof Array?cl.findValue('id',id,key||'name',key?'':DEF.empty):(key?'':DEF.empty)};Thelpers.clicon=function(id,name,key){var cl=DEF.cl[name];var item = cl instanceof Array?cl.findItem('id',id):null;return item?((item.icon?('<i class="'+item.icon+' mr5"'+(item.color?(' style="color:'+item.color+'"'):'')+'></i>'):'')+(item[key||'name']||'')):''};

// jRouting
(function(p){var v='NAV.';var h={version:16.3,hashtags:false,middlewares:{},params:[],query:{},query2:{},routes:[],url:'',count:0};var d={$prev:[],$next:[],isReady:false,LIMIT_HISTORY:100,LIMIT_HISTORY_ERROR:100};h.history=d.$prev;var f=location;!p.NAV&&(p.NAV=h);h.custom=function(r){h.$custom=true;if(r==null||r==true||typeof r==='string')CACHEPATH('NAV.href',r==null||r==true?'1 month':r)};h.remember=function(r,e){if(e===null)delete h.query2[r];else h.query2[r]=e==undefined?h.query[r]:e};h.remove=function(r){r=r.env(true).ROOT(true);var e=[];for(var t=0;t<h.routes.length;t++)h.routes[t].id!==r&&e.push(h.routes[t]);h.routes=e;return h};h.autosave=function(){h.$save=1};h.save=function(){try{localStorage.setItem(DEF.localstorage+'.nav',STRINGIFY({prev:d.$prev,next:d.$next,ts:new Date}))}catch(r){}};h.load=function(){try{var r=PARSE(localStorage.getItem(DEF.localstorage+'.nav')||'null');if(r){if(r.prev instanceof Array)d.$prev=h.history=r.prev;if(r.next instanceof Array)d.$next=r.next;h.$pop=true}}catch(r){}};p.ROUTE=function(r,e,t,n){var i;if(e instanceof Array){var i=t;t=e;e=i}if(typeof t==='function'){i=n;n=t;t=i}r=r.env(true).ROOT(true);var a=r.jRcount('/')+(r.indexOf('*')===-1?0:10);var u=h._route(r.trim());var o=[];if(typeof t==='string')t=t.split(',').trim();var s=[];var l=[];var c={};t instanceof Array&&t.forEach(function(r){if(typeof r==='object')c=r;else if(r.substring(0,1)==='@')l.push(r.substring(1));else s.push(r)});if(r.indexOf('{')!==-1){a-=100;for(var f=0;f<u.length;f++)u[f].substring(0,1)==='{'&&o.push(f);a-=o.length}h.remove(r);h.routes.push({id:r,url:u,fn:e,priority:a,params:o,middleware:s.length?s:null,init:n,count:0,pending:false,options:c,roles:l});h.routes.sort(function(r,e){return r.priority>e.priority?-1:r.priority<e.priority?1:0});h.is404&&(r===h.url||r.indexOf('{')!==-1)&&p.REDIRECT(h.href+location.hash);EMIT('route',r);return h};p.MIDDLEWARE=function(r,e){if(r instanceof Array){r.wait(function(r,e){var t=h.middlewares[r];if(t)t(e);else e()},e);return h}h.middlewares[r]=e;return h};h.refresh=function(){return h.location(h.url,true)};h.reload=function(){return h.refresh()};h._route=function(r){if(r.charCodeAt(0)===47)r=r.substring(1);if(r.charCodeAt(r.length-1)===47)r=r.substring(0,r.length-1);var e=r.split('/');if(e.length===1&&!e[0])e[0]='/';return e};h._route_param=function(r,e){var t=[];if(!e||!r)return t;var n=e.params.length;if(n){for(var i=0;i<n;i++){var a=r[e.params[i]];t.push(a==='/'||/\{|\}/.test(a)?'':a)}}return t};h._route_compare=function(r,e){var t=r.length;var n=t===1&&r[0]==='/';if(e.length!==t)return false;for(var i=0;i<t;i++){var a=e[i];if(!a)return false;if(!n&&a.charCodeAt(0)===123)continue;if(a==='*')return true;if(r[i]!==a)return false}return true};h.location=function(r,e){if(r)NAV.href=r;d.isReady=true;var t=r.indexOf('?');var n='';if(t!==-1){n=r.substring(t);r=r.substring(0,t)}r=g(r);r=h.path(r);var i=h._route(r);var a=[];var u=true;var o=[];o.push.apply(o,i);for(var s=0;s<i.length;s++)i[s]=i[s].toLowerCase();if(!e&&h.url.length&&h.prev()!==h.url){if(h.$pop)h.$pop=false;else{d.$prev.push(h.url);d.$prev.length>h.LIMIT_HISTORY&&d.$prev.shift();d.$next.length>h.LIMIT_HISTORY&&d.$next.shift();h.$save&&h.save()}}if(h.isback!==d.$prev.length)SET(v+'isback',d.$prev.length);if(h.isforward!==d.$next.length)SET(v+'isforward',d.$next.length);for(var s=0;s<h.routes.length;s++){var f=h.routes[s];if(!h._route_compare(i,f.url))continue;if(f.url.indexOf('*')===-1)u=false;if(f.once&&f.count>0)continue;f.count++;a.push(f);break}var l=false;var c=[];var p=h.url;h.url=r;if(h.url!==p)UPD(v+'url');UPD(v+'href');h._params(n);h.params=h._route_param(o,f);UPD(v+'params');h.is404=false;EMIT('location',r);for(var s=0;s<a.length;s++){var f=a[s];if(f.pending)continue;if(!f.middleware||!f.middleware.length){if(!f.init){f.fn.apply(h,h.params);continue}f.pending=true;(function(r){r.init(function(){r.fn.apply(h,h.params);r.pending=false})})(f);f.init=null;continue}(function(e){var r=e.middleware.length;var n=[];var i=h.url;for(var t=0;t<r;t++){var a=e.middleware[t];if(a.charAt(0)==='#'){(function(e){n.push(r=>CL(e,()=>r()))})(a.substring(1));continue}var u=h.middlewares[a];u&&function(e,t){n.push(function(r){if(h.url!==i){n=null;r=null;e.pending=false}else t.call(h,r,e.options,e.roles,e)})}(e,u)}if(!e.init){e.pending=true;n.jRmiddleware(function(r){if(h.url===i)!r&&e.fn.apply(h,h.params);e.pending=false},e);return}e.pending=true;e.init(function(){n.jRmiddleware(function(r){if(h.url===i)!r&&e.fn.apply(h,h.params);e.pending=false},e)});e.init=null})(f)}l&&h.status(500,c);if(u){h.is404=true;h.status(404)}else h.is404=false};h.prev=function(){return d.$prev[d.$prev.length-1]};h.next=function(){return d.$next[d.$next.length-1]};h.back=function(){var r=d.$prev.pop()||'/';if(h.url&&h.next()!==h.url)d.$next.push(h.url);h.url='';p.REDIRECT(r);h.$save&&h.save();return h};h.forward=function(){var r=d.$next.pop()||'/';if(h.url&&h.prev()!==h.url)d.$prev.push(h.url);h.url='';p.REDIRECT(r);h.$save&&h.save();return h};h.status=function(r,e){EMIT(r+'',e);return h};NAV.redirect=p.REDIRECT=function(r){if(!r)r=h.url;var e=false;r=r.env(true).ROOT(true).replace(/\s(@)?nohistory/i,function(){e=true;return''});if(Object.keys(h.query2).length)r=QUERIFY(r,h.query2);r=r.flags(null,r,'redirect');if(r.indexOf('./')!==-1){var t=NAV.url;var n=r.indexOf('?');var i=n===-1?'':r.substring(n);if(r==='./'){REDIRECT(NAV.url);return}var a=r.match(/\.\.\//g);var u=t.split('/').trim();t='/'+u.splice(0,u.length-a.length).join('/');if(t.charAt(t.length-1)!=='/')t+='/';t+=i;REDIRECT(t);return}var o=r.charCodeAt(0);var s=f;if(o===35){s.hash=r;h.location(r,false)}else if(h.$custom){h.location(r,false)}else if(history.pushState){if(!e)history.pushState(null,null,r);h.location(s.pathname+s.search,false)}else s.href=r};h._params=function(r){var e={};h.queryraw=(r||f.search).substring(1);var t=h.queryraw.split('&');for(var n=0;n<t.length;n++){var i=t[n].replace(/\+/g,'%20').split('=');if(i.length!==2)continue;var a=decodeURIComponent(i[0]);var u=decodeURIComponent(i[1]);var o=e[a]instanceof Array;if(e[a]&&!o)e[a]=[e[a]];if(o)e[a].push(u);else e[a]=u}h.query=e;var s=v+'query';p.M&&UPD(s);return h};h.path=function(r,e){if(r.substring(0,1)==='#')return r;if(!e)e='/';var t=r.indexOf('?');var n='';if(t!==-1){n=r.substring(t);r=r.substring(0,t)}var i=r.length;var a=r.substring(i-1,i);if(a!==e)r+=e;return r+n};function g(r){if(r.substring(0,1)==='#')return r;var e=r.indexOf('#');return e!==-1?r.substring(0,e):r}Array.prototype.jRmiddleware=function(e,t){var n=this;var r=n.shift();if(r===undefined){e&&e();return n}r(function(r){if(r instanceof Error||r===false)e&&e(r===false?true:r);else setTimeout(function(){n.jRmiddleware(e,t)},1)},t.options,t.roles);return n};String.prototype.jRcount=function(r){var e=0;var t=0;do{e=this.indexOf(r,e+r.length);if(e>0)t++}while(e>0);return t};h.clientside=function(r){$(document).on('click',r,function(r){r.preventDefault();var e=$(this);var t=e.attr('href')||e.attrd('href')||e.attrd('url');if(t!=='javas'+'cript:vo'+'id(0)'&&t!=='#')p.REDIRECT(t)});return h};function r(){NAV.ua=MAIN.ua;$(document).ready(function(){if(!h.$custom){if(h.hashtags)h.url=f.hash||h.path(g(f.pathname));else h.url=h.path(g(f.pathname))}setTimeout(function(){if(!d.isReady)h.location(h.href||h.url)},5);$(p).on('hashchange',function(){d.isReady&&h.hashtags&&h.location(h.path(f.hash))}).on('popstate',function(){if(d.isReady&&!h.hashtags&&!h.$custom){var r=h.path(f.pathname);h.url!==r&&h.location(r)}})})}if(p.jQuery&&p.MAIN&&p.MAIN.loaded){r()}else{h.init=setInterval(function(){if(p.jQuery&&p.MAIN&&p.MAIN.loaded){clearInterval(h.init);r()}},100)}h._params()})(window);
